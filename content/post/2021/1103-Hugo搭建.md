搭建流程基于Windows 10环境，使用Vercel进行网站托管及自动部署，博客使用Stack主题。

需要网络良好能搭梯子（或者不介意等待国外网站的加载速度/能自己搜索相关国内下载地址），有基础的英语阅读能力（或者熟练掌握Google网页翻译和复制粘贴到Deepl翻译），花十分钟了解一下Markdown是什么以及基础写作语法，同时具备一些计算机基础常识——如果使用360之类的国产浏览器的话，换一个Google Chrome。

另外注意，其中有一些步骤严格来说并不是必须的，比如Github文档中提到“如果已安装 [GitHub Desktop](https://desktop.github.com/)，可使用它克隆仓库，而无需处理 SSH 密钥。”，但在设置并不复杂的情况下，准备一个则有备无患。

## 前期准备

1. [Hugo](https://github.com/gohugoio/hugo/releases/tag/v0.89.0)，Hugo是一个静态网页生成器，它把我们博客文件夹中的文件渲染成可以在网上展示的Html网页，下载时，把网页往下拉，找到Assets部分，下载[hugo_extended_0.89.0_Windows-64bit.zip](https://github.com/gohugoio/hugo/releases/download/v0.89.0/hugo_extended_0.89.0_Windows-64bit.zip)，并解压到你希望博客文件夹在的位置，示例中，我们下载到E盘的根目录，即`E:\`
2. [Git](https://git-scm.com/)，Git是一个分布式版本控制系统，这里我们用它进行博客文件夹从本地到Github（repo）的推送（push），另外，博客相关命令也需要通过右键文件夹，点击`Git bash Here`来执行。下载后一路点击下一步安装即可。
3. [Github Desktop](https://desktop.github.com/)，这是Github推出的一个Git客户端，我们用来简化Git推送命令。如果不习惯全英界面，民间有一个[汉化补丁](https://github.com/lkyero/GitHubDesktop_zh)，汉化了大多数界面。但需要注意的是，最新版汉化后有时会出现Git推送后[报错](https://github.com/lkyero/GitHubDesktop_zh/issues/43)的情况，如果同样出现链接中的报错提示，请把汉化部分删掉。
4. [VScode](https://code.visualstudio.com/)，用来编辑代码，下载后，请点击`Extensions`，安装`Chinese Language Pack for Visual Studio Code` 和`Markdown All in One`插件，前者用来汉化VScode界面，后者则是Markdown编辑插件。VScode有很多非常有用的插件，可以自行摸索。
5. 准备一个[Github](https://github.com/)账号，Github负责储存我们的博客文件。

## 安装HUGO

使用配置环境变量的方式安装Hugo，这里假设我们把`Hugo.exe`放在`E:\`

1. 点开`控制面板`，在控制面板中找到`系统`
2. 点击`高级系统设置`，在`高级`分页中最下面，找到`环境变量`
3. 在上方的用户变量中，找到`Path`变量，点击编辑，在弹出的窗口中选择新建，输入之前放置`Hugo.exe`文件的文件夹路径

测试是否配置成功？在`E:\中任意空白处右键，点击`Git Bash Here`，在弹出的命令行界面中输入：

```
hugo version
```

返回 Hugo 版本号信息，说明配置成功。记住`Git Bash Here`，后面我们输入命令行的时候都要用到它

```
hugo v0.88.1-5BC54738+extended windows/amd64 BuildDate=2021-09-04T09:39:19Z VendorInfo=gohugoio //这里我用的是0.88.1版本，如果用最新版本，会显示v0.89.0
```

## 配置SSH

SSH 密钥的作用是链接本地和 Git 服务器，它成对生成，分别是”公钥 “和” 私钥 “，我们将其中的” 公钥“保存到 Git 仓库后，就可以在电脑上向这个 Git 仓库提交代码。

Github Docs有一篇SSH连接的[中文文档](https://docs.github.com/cn/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent)，可以辅助参考。

### 生成SSH

安装 Git 之后，在桌面点开 Git 图标，或者右键任意地方，选择 `Git Bash Here`，在弹出的命令行窗口里输入

```
$ ssh-keygen -t rsa -C "输入github账号注册时使用的邮箱"
```

之后系统会提示是否需要指定密钥位置、是否输入密码，这里可以按需输入，也可以直接一路回车，显示如下结果时即为生成成功

```
Your identification has been saved in id_rsa.
Your public key has been saved in id_rsa.pub.
```

### 连接SSH

先找到公钥，公钥的地址是`C:\Users\用户名\.ssh\id_rsa.pub`，右键用记事本打开，复制里面的全部内容。

打开 Github 账号，右上角头像 - Settings，在左边找到`SSH and GPG keys`选项，新建一个 SSH 密钥，标题可以随便填，把之前复制的密钥内容粘贴进去，保存。

测试是否完成了SSH连接？在 `Git Bash Here`中输入

```
ssh -T git@github.com //输入的命令
Hi username! You've successfully authenticated, but GitHub does not provide shell access. //返回这句话则添加SSH连接成功，username处会显示你设置的用户名
```

如果返回以下内容，输入yes，再回车

```
> The authenticity of host 'github.com (IP ADDRESS)' can't be established.
> RSA key fingerprint is SHA256:nThbg6kXUpJWGl7E1IGOCspRomTxdCARLviKw6E5SY8.
> Are you sure you want to continue connecting (yes/no)?
```

## 搭建博客

这里我们使用Vercel来进行博客搭建，Vercel是一个开箱即用的网站托管服务，通过它我们可以获得：一个非常简单的博客搭建过程、一个静态博客自动部署服务（什么是自动部署后面再说）、还不错的网页国内访问加速，同时它还允许你将博客的源代码仓库设为私密。

点击Verce[注册](https://vercel.com/signup)页面，选择使用Github账号注册，弹出授权窗口时，点击`Authorize Vercel`，随后跳转到Let's build something new页面（如果没有，在Dashboard点击New project），之后点击Browse All Templates，下拉，找到Hugo。在Create Git Repository模块点击GIT SCOPE下拉列表，点击Add GitHub Org or Account，弹出安装窗口，点击Install。之后再在GIT SCOPE中点击你的Github账户，在右侧REPOSITORY NAME位置输入你想设置的仓库名（这里输入什么都可以，我们举例时就命名它为Hugo），依次点击Create-Skip，等待约半分钟，Vercel就会自动搭建一个Hugo博客。

![https://res.cloudinary.com/mantyke/image/upload/v1635925267/211103 Hugo搭建/2_tuofrj.png](https://res.cloudinary.com/mantyke/image/upload/v1635925267/211103%20Hugo%E6%90%AD%E5%BB%BA/2_tuofrj.png)

此时点击Go to Dashboard可以进入管理页面，红框部分即为自动分配的访问网址，同时你的Github仓库中，会出现一个由Vercel创建的叫Hugo的博客仓库

![https://res.cloudinary.com/mantyke/image/upload/v1635925396/211103 Hugo搭建/3_ojljwd.png](https://res.cloudinary.com/mantyke/image/upload/v1635925396/211103%20Hugo%E6%90%AD%E5%BB%BA/3_ojljwd.png)

然后配置环境变量：在Vercel上点击左上角的用户名，进入Dashboard，点击刚刚建立的Hugo项目，进入后在上方选项卡处找到Setting进入设置页面，在左侧点击Environment Variables，NAME处填写HUGO_VERSION，Value处填写版本号，例如最新版本为0.89.0，最后点击加入

这一步是因为Vercel本身自带的Hugo版本比较老了，所以需要告诉它我们使用的Hugo版本是什么。

![https://res.cloudinary.com/mantyke/image/upload/v1635927128/211103 Hugo搭建/4_cso0fs.png](https://res.cloudinary.com/mantyke/image/upload/v1635927128/211103%20Hugo%E6%90%AD%E5%BB%BA/4_cso0fs.png)

## 安装主题

首先我们把Github仓库克隆到本地。打开Github Desktop，登录Github账号，点击右下角Clone仓库

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8c3f3620-e884-4a2c-89c9-9c627bc0ca68/Untitled.png)

在随后弹出的窗口中，点击Local path选项右边的Choose，将Local Path设置为你想要博客文件存放的路径，比如可以放在`E:\Hugo`，注意目标文件夹一定要是空的

示例中使用的主题是[Stack](https://github.com/CaiJimmy/hugo-theme-stack)，也可以在[Hugo Themes](https://www.gohugo.org/theme/)中找自己的喜欢的主题。选择主题的时候需要注意，有一些博客功能Hugo是不原生支持的，比如文章归档和搜索，需要后期添加，有点麻烦。所以如果需要，最好在挑选主题的时候就注意下主题是不是支持这些功能。

安装主题可以采取各种方式，比如比较推荐的使用`git submodule` 方式安装（好处在于可以方便地同步作者更新），但这里我们选一个比较简单粗暴便于理解的方式：直接把主题文件下载下来。

1. 打开Github仓库，点击右上角绿色的Code，选择Download ZIP，下载主题的压缩包，随后解压（随便解压到哪里），并把解压后的文件夹重命名为`Stack`——重命名主要是为了之后写起来方便。

2. 重命名后，把`Stack`文件夹复制到`E:\Hugo\themes` 文件夹中，随后打开`E:\Hugo\themes\stack\exampleSite`文件夹，将`exampleSite`文件夹中的所有内容复制到`E:\Hugo`中，如果提示是否覆盖文件，选择覆盖。`exampleSite`是主题作者提供的示例站点文件，利用它我们可以方便地运行主题，同时预览主题效果。

3. 删除`E:\Hugo`中的`config.toml`文件，只保留`config.yaml`文件，如果`E:\Hugo`或`E:\Hugo\themes\stack`有`.gitignore`文件也一并删去（`.gitignore`的作用是让Git忽略文件中提到的提交，而我们之后需要把整个站点文件夹推送到Github，因此需要删去）

4. 用VScode打开`config.yaml`，修改第三行为`theme: stack`（这里的名字需要和主题文件夹的名字保持一致）

5. 在`E:\Hugo`右键执行`Git bash Here`，输入`hugo server`（本地预览站点命令），之后顺利的话，会显示以下代码，即为博客本地预览成功启动：

   ```
   $ hugo server
   Start building sites …
   hugo v0.88.1-5BC54738+extended windows/amd64 BuildDate=2021-09-04T09:39:19Z VendorInfo=gohugoio
   
                      | EN
   -------------------+-----
     Pages            | 73
     Paginator pages  | 18
     Non-page files   |  0
     Static files     | 15
     Processed images | 14
     Aliases          | 20
     Sitemaps         |  1
     Cleaned          |  0
   
   Built in 483 ms
   Watching for changes in E:\Hugo\hugo-stack\{archetypes,assets,content,data,layouts,static,themes}
   Watching for config changes in E:\Hugo\hugo-stack\config.yaml
   Environment: "development"
   Serving pages from memory
   Running in Fast Render Mode. For full rebuilds on change: hugo server --disableFastRender
   Web Server is available at http://localhost:1313/ (bind address 127.0.0.1) 
   Press Ctrl+C to stop
   ```

   之后把`http://localhost:1313/`复制到浏览器的地址栏回车访问，应该就可以看到博客成功显示出来了。如果需要关闭本地预览，关掉命令行窗口或在命令行窗口按下Ctrl+C。

## 推送到Github

之后，我们需要把我们本地经过修改的`E:\Hugo`文件夹，推送给Github上的博客仓库，这样才能修改博客的网页显示。打开Github Desktop，如果一切顺利，这时候我们可以看到在左侧的change窗口，已经密密麻麻列出了几百个文件改动，仔细看会发现，它们就是我们加入到`E:\Hugo`文件夹的一系列文件。

我们在

